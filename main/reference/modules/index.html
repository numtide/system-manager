
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Declarative system management for any Linux machine using Nix.">
      
      
      
        <link rel="canonical" href="https://system-manager.net/main/reference/modules/">
      
      
        <link rel="prev" href="../configuration/">
      
      
        <link rel="next" href="../remote-flakes/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Modules - System Manager</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#modules" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="System Manager" class="md-header__button md-logo" aria-label="System Manager" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            System Manager
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Modules
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="deep-orange" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="deep-orange" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/numtide/system-manager" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    numtide/system-manager
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../introduction/" class="md-tabs__link">
        
  
  
    
  
  Introduction

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../getting-started/" class="md-tabs__link">
        
  
  
    
  
  Getting Started

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../install/" class="md-tabs__link">
        
  
  
    
  
  Installation

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
    
  
  Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../faq/" class="md-tabs__link">
        
  
  
    
  
  FAQ

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="System Manager" class="md-nav__button md-logo" aria-label="System Manager" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    System Manager
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/numtide/system-manager" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    numtide/system-manager
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI Commands
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Modules
  

    
  </span>
  
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../remote-flakes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Remote Flakes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../blueprint/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Blueprint
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../examples/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_7" id="__nav_5_7_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Examples
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/timer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Timer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/postgresql/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PostgreSQL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/nginx/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Nginx
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/nginx-https/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Nginx HTTPS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/custom-app/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Custom App
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FAQ
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


  <nav class="md-path" aria-label="Navigation" >
    <ol class="md-path__list">
      
        
  
  
    <li class="md-path__item">
      <a href="../.." class="md-path__link">
        
  <span class="md-ellipsis">
    Home
  </span>

      </a>
    </li>
  

      
      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../" class="md-path__link">
          
  <span class="md-ellipsis">
    Reference
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="modules">Modules<a class="headerlink" href="#modules" title="Permanent link">&para;</a></h1>
<p>This guide covers how to write <code>.nix</code> configuration modules for System Manager, including services, packages, <code>/etc</code> files, and tmpfiles.</p>
<h1 id="building-system-manager-nix-files">Building System Manager <code>.nix</code> files<a class="headerlink" href="#building-system-manager-nix-files" title="Permanent link">&para;</a></h1>
<p>Ready for an example! For this example, we're going to use the following:</p>
<ul>
<li>
<p>Our files will live in <code>~/.config/system-manager</code></p>
</li>
<li>
<p>We'll have two files, one <code>flake.nix</code>, and <code>system.nix</code></p>
</li>
</ul>
<p>Note that we'll be using the files generated by System Manager's <code>init</code> subcommand. But to show that we're not locked into that format, later we'll demonstrate a single <code>flake.nix</code> file. Then in the sections that follow, we'll demonstrate how you can further split up your files.</p>
<p>We'll demonstrate how to install an app on your machine, then we'll add another app, then we'll uninstall the first app.</p>
<p>We'll also demonstrate how to move items from your <code>/etc/nix/nix.conf</code> file into your System Manager configuration file.</p>
<h2 id="the-main-flakenix-file">The Main <code>flake.nix</code> File<a class="headerlink" href="#the-main-flakenix-file" title="Permanent link">&para;</a></h2>
<p>We recommend you start with a basic <code>flake.nix</code> file similar to this:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="p">{</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>  <span class="ss">description</span> <span class="o">=</span> <span class="s2">&quot;Standalone System Manager configuration&quot;</span><span class="p">;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>  <span class="ss">inputs</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>    <span class="c1"># Specify the source of System Manager and Nixpkgs.</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>    nixpkgs<span class="o">.</span><span class="ss">url</span> <span class="o">=</span> <span class="s2">&quot;github:nixos/nixpkgs/nixos-unstable&quot;</span><span class="p">;</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>    <span class="ss">system-manager</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>      <span class="ss">url</span> <span class="o">=</span> <span class="s2">&quot;github:numtide/system-manager&quot;</span><span class="p">;</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>      inputs<span class="o">.</span>nixpkgs<span class="o">.</span><span class="ss">follows</span> <span class="o">=</span> <span class="s2">&quot;nixpkgs&quot;</span><span class="p">;</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>    <span class="p">};</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>  <span class="p">};</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>  <span class="ss">outputs</span> <span class="o">=</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>    <span class="p">{</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>      self<span class="p">,</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>      nixpkgs<span class="p">,</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>      system-manager<span class="p">,</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>      <span class="o">...</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>    <span class="p">}:</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="k">let</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>      <span class="ss">system</span> <span class="o">=</span> <span class="s2">&quot;x86_64-linux&quot;</span><span class="p">;</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="k">in</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="p">{</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>      systemConfigs<span class="o">.</span><span class="ss">default</span> <span class="o">=</span> system-manager<span class="o">.</span>lib<span class="o">.</span>makeSystemConfig <span class="p">{</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>        <span class="c1"># Specify your system configuration modules here, for example,</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>        <span class="c1"># the path to your system.nix.</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>        <span class="ss">modules</span> <span class="o">=</span> <span class="p">[</span> <span class="l">./system.nix</span> <span class="p">];</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>        <span class="c1"># Optionally specify extraSpecialArgs and overlays</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>      <span class="p">};</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="p">};</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>This is a typical flake with an <code>inputs</code> and an <code>outputs</code> section. The inputs loads in <code>nixpkgs</code> and <code>system-manager</code>. The outputs part has one primary job: It calls System Manager's <code>makeSystemConfig</code> function, passing in any number of <code>.nix</code> modules.</p>
<p>Each module, in turn, must specify a <code>config</code> object, containing configuration settings. These can be in separate files, and Nix will merge them into a single <code>config</code> object that gets passed into <code>makeSystemConfig</code>.</p>
<p>Your <code>config</code> attribute set can have:</p>
<ul>
<li><code>nixpkgs.hostPlatform</code>: This specifies the platform such as <code>nixpkgs.hostPlatform = "x86_64-linux";</code></li>
<li><code>environment</code>, consisting of</li>
<li><code>systemPackages</code></li>
<li><code>etc</code></li>
<li><code>systemd.services</code></li>
<li><code>systemd.tmpfiles</code></li>
</ul>
<p>For example, you could then replace the</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="ss">modules</span> <span class="o">=</span> <span class="p">[</span> <span class="l">./system.nix</span> <span class="p">];</span>
</code></pre></div></td></tr></table></div>
<p>line with individual <code>.nix</code> files. For example, you might have one file that installs the <code>bat</code> command, and another file that installs the <code>tree</code> command.</p>
<p>As an example, let's put these two files in a <code>modules</code> folder under the folder holding <code>flake.nix</code>. Replace the modules line with this:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span>
<span class="normal"><a href="#__codelineno-2-4">4</a></span>
<span class="normal"><a href="#__codelineno-2-5">5</a></span>
<span class="normal"><a href="#__codelineno-2-6">6</a></span>
<span class="normal"><a href="#__codelineno-2-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="ss">modules</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a>  <span class="p">{</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a>    nixpkgs<span class="o">.</span><span class="ss">hostPlatform</span> <span class="o">=</span> <span class="s2">&quot;x86_64-linux&quot;</span><span class="p">;</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a>  <span class="p">}</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a>  <span class="l">./modules/tree.nix</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a>  <span class="l">./modules/bat.nix</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="p">];</span>
</code></pre></div></td></tr></table></div>
<p>Then here are the individual "recipe" files.</p>
<p><strong>modules/bat.nix</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="p">{</span> lib<span class="p">,</span> pkgs<span class="p">,</span> <span class="o">...</span> <span class="p">}:</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="p">{</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>  <span class="ss">config</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a>    <span class="ss">environment</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a>      <span class="c1"># Packages that should be installed on a system</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a>      <span class="ss">systemPackages</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a>        pkgs<span class="o">.</span>bat
<a id="__codelineno-3-8" name="__codelineno-3-8"></a>      <span class="p">];</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a>    <span class="p">};</span>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a>  <span class="p">};</span>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>modules/tree.nix</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="p">{</span> lib<span class="p">,</span> pkgs<span class="p">,</span> <span class="o">...</span> <span class="p">}:</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="p">{</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a>  <span class="ss">config</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a>    <span class="ss">environment</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a>      <span class="c1"># Packages that should be installed on a system</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a>      <span class="ss">systemPackages</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a>        pkgs<span class="o">.</span>tree
<a id="__codelineno-4-8" name="__codelineno-4-8"></a>      <span class="p">];</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a>    <span class="p">};</span>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a>  <span class="p">};</span>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Why take this approach? Because you could, for example, have many different recipes stored in a GitHub repo (or anywhere, really), and you could easily drop them into your system, adding a single line in <code>flake.nix</code> for each. Each one would have their own software installations. And this solves the problem described in <a href="../configuration/#dealing-with-conflicting-nix-files">Dealing with Conflicting <code>.nix</code> Files</a></p>
<h1 id="managing-system-services">Managing System Services<a class="headerlink" href="#managing-system-services" title="Permanent link">&para;</a></h1>
<p>System Manager lets you manage systemd services declaratively, using the same module language you used for installing packages or creating files under <code>/etc</code>. Instead of manually placing service files in <code>/etc/systemd/system</code> or enabling them with <code>systemctl</code>, you describe the service in a Nix module--its command, environment, dependencies, restart behavior, and any timers or sockets it needs.</p>
<p>System Manager then generates the correct systemd unit files, installs them into the right directory, and reloads systemd automatically during a switch. This approach gives you repeatability and safety: if you rebuild a machine, the same services come back exactly as before; if a service configuration breaks, you simply roll back to the previous generation. Declarative service management also avoids drift--no accidental edits, no forgotten manual steps, and no inconsistencies between machines or team members.</p>
<p>Using this approach, instead of manually saving a file in <code>/etc/systemd/system</code> and then manually starting and stopping the service, you use a <code>.nix</code> file to <em>declaratively</em> state what you want the service to look like and that you want it to be active.</p>
<p>Then you can take this same <code>.nix</code> file, place it on another system, and run System Manager again, and you'll have the service installed in a way that's identical to the first system.</p>
<p>The following example demonstrates how to specify a system service and activate it.</p>
<p>We're assuming you're using a <code>flake.nix</code> similar to what's found in <a href="#the-main-flakenix-file">The Main <code>flake.nix</code> File</a>.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span>
<span class="normal"><a href="#__codelineno-5-17">17</a></span>
<span class="normal"><a href="#__codelineno-5-18">18</a></span>
<span class="normal"><a href="#__codelineno-5-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="p">{</span> lib<span class="p">,</span> pkgs<span class="p">,</span> <span class="o">...</span> <span class="p">}:</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="p">{</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a>  <span class="ss">config</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a>    nixpkgs<span class="o">.</span><span class="ss">hostPlatform</span> <span class="o">=</span> <span class="s2">&quot;x86_64-linux&quot;</span><span class="p">;</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a>    systemd<span class="o">.</span>services<span class="o">.</span><span class="ss">say-hello</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a>      <span class="ss">description</span> <span class="o">=</span> <span class="s2">&quot;say-hello&quot;</span><span class="p">;</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a>      <span class="ss">enable</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a>      <span class="ss">wantedBy</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;system-manager.target&quot;</span> <span class="p">];</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a>      <span class="ss">serviceConfig</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a>        <span class="ss">Type</span> <span class="o">=</span> <span class="s2">&quot;oneshot&quot;</span><span class="p">;</span>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a>        <span class="ss">RemainAfterExit</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a>      <span class="p">};</span>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a>      <span class="ss">script</span> <span class="o">=</span> <span class="s s-Multiline">&#39;&#39;</span>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="s s-Multiline">        </span><span class="si">${</span>lib<span class="o">.</span>getBin pkgs<span class="o">.</span>hello<span class="si">}</span><span class="s s-Multiline">/bin/hello</span>
<a id="__codelineno-5-16" name="__codelineno-5-16"></a><span class="s s-Multiline">      &#39;&#39;</span><span class="p">;</span>
<a id="__codelineno-5-17" name="__codelineno-5-17"></a>    <span class="p">};</span>
<a id="__codelineno-5-18" name="__codelineno-5-18"></a>  <span class="p">};</span>
<a id="__codelineno-5-19" name="__codelineno-5-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Note:</p>
<p>This line is required in the above example:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="ss">wantedBy</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;system-manager.target&quot;</span> <span class="p">];</span>
</code></pre></div></td></tr></table></div>
<p>(There are other options for <code>wantedBy</code>; we discuss it in full under <a href="#specifying-the-wantedby-setting">Specifying <code>wantedBy</code> Setting</a>)</p>
<p>Activate it using the same nix command as earlier:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a>nix<span class="w"> </span>run<span class="w"> </span><span class="s1">&#39;github:numtide/system-manager&#39;</span><span class="w"> </span>--<span class="w"> </span>switch<span class="w"> </span>--flake<span class="w"> </span>.<span class="w"> </span>--sudo
</code></pre></div></td></tr></table></div>
<p>This will create a system service called <code>say-hello</code> (the name comes from the line <code>systemd.services.say-hello</code>) in a unit file at <code>/etc/systemd/system/say-hello.service</code> with the following inside it:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span>
<span class="normal"><a href="#__codelineno-8-11">11</a></span>
<span class="normal"><a href="#__codelineno-8-12">12</a></span>
<span class="normal"><a href="#__codelineno-8-13">13</a></span>
<span class="normal"><a href="#__codelineno-8-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="k">[Unit]</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="na">Description</span><span class="o">=</span><span class="s">say-hello</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="k">[Service]</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="na">Environment</span><span class="o">=</span><span class="s">&quot;PATH=/nix/store/xs8scz9w9jp4hpqycx3n3bah5y07ymgj-coreutils-9.8/bin:/nix/store/qqvfnxa9jg71wp4hfg1l63r4m78iwvl9-findutils-4.10.0/bin:/nix/store/22r4s6lqhl43jkazn51f3c18qwk894g4-gnugrep-3.12/bin:</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="na">/nix/store/zppkx0lkizglyqa9h26wf495qkllrjgy-gnused-4.9/bin:/nix/store/g48529av5z0vcsyl4d2wbh9kl58c7p73-systemd-minimal-258/bin:/nix/store/xs8scz9w9jp4hpqycx3n3bah5y07ymgj-coreutils-9.8/sbin:/nix/store/qqvfn</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="na">xa9jg71wp4hfg1l63r4m78iwvl9-findutils-4.10.0/sbin:/nix/store/22r4s6lqhl43jkazn51f3c18qwk894g4-gnugrep-3.12/sbin:/nix/store/zppkx0lkizglyqa9h26wf495qkllrjgy-gnused-4.9/sbin:/nix/store/g48529av5z0vcsyl4d2wbh9</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="na">kl58c7p73-systemd-minimal-258/sbin&quot;</span>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="na">ExecStart</span><span class="o">=</span><span class="s">/nix/store/d8rjglbhinylg8v6s780byaa60k6jpz1-unit-script-say-hello-start/bin/say-hello-start</span>
<a id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="na">RemainAfterExit</span><span class="o">=</span><span class="s">true</span>
<a id="__codelineno-8-11" name="__codelineno-8-11"></a><span class="na">Type</span><span class="o">=</span><span class="s">oneshot</span>
<a id="__codelineno-8-12" name="__codelineno-8-12"></a>
<a id="__codelineno-8-13" name="__codelineno-8-13"></a><span class="k">[Install]</span>
<a id="__codelineno-8-14" name="__codelineno-8-14"></a><span class="na">WantedBy</span><span class="o">=</span><span class="s">system-manager.target</span>
</code></pre></div></td></tr></table></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Compare the lines in the <code>say-hello.service</code> file with the <code>say_hello.nix</code> file to see where each comes from.</p>
</div>
<p>You can verify that it ran by running <code>journalctl</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a>journalctl<span class="w"> </span>-n<span class="w"> </span><span class="m">20</span>
</code></pre></div></td></tr></table></div>
<p>and you can find the following output in it:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span>
<span class="normal"><a href="#__codelineno-10-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a>Nov 18 12:12:51 my-ubuntu systemd[1]: Starting say-hello.service - say-hello...
<a id="__codelineno-10-2" name="__codelineno-10-2"></a>Nov 18 12:12:51 my-ubuntu say-hello-start[3488278]: Hello, world!
<a id="__codelineno-10-3" name="__codelineno-10-3"></a>Nov 18 12:12:51 my-ubuntu systemd[1]: Finished say-hello.service - say-hello.
</code></pre></div></td></tr></table></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you remove the <code>./apps.nix</code> line from <code>flake.nix</code>, System Manager will see that the configuration changed and that the apps listed in it are no longer in the configuration. As such, it will uninstall them. This is normal and expected behavior.</p>
</div>
<h2 id="specifying-the-wantedby-setting">Specifying the <code>wantedBy</code> Setting<a class="headerlink" href="#specifying-the-wantedby-setting" title="Permanent link">&para;</a></h2>
<p>The <code>wantedBy</code> attribute tells systemd when to automatically start a service. System Manager includes its own systemd target that you can use in the <code>wantedBy</code> setting to automatically start any services immediately after applying the changes, as well as after reboot. Here's an example <code>wantedBy</code> line in a <code>.nix</code> configuration file:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="ss">wantedBy</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;system-manager.target&quot;</span> <span class="p">];</span>
</code></pre></div></td></tr></table></div>
<p>(By allowing the service to start after applying changes, you don't need to reboot for the service to start.)</p>
<p>But you're not limited to just this target. For example, if you're creating a system service that runs on a schedule, you might use this:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="ss">wantedBy</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;timers.target&quot;</span> <span class="p">]</span>
</code></pre></div></td></tr></table></div>
<h1 id="managing-software-installations">Managing Software Installations<a class="headerlink" href="#managing-software-installations" title="Permanent link">&para;</a></h1>
<p>System Manager allows you to install software in a fully declarative way similar to installing system services. Instead of relying on a traditional package manager and running commands like <code>apt install</code> or <code>dnf install</code>, you list the packages you want in your configuration file. During a switch, System Manager builds a new system profile that includes those packages, activates it, and ensures the software is available on your <code>PATH</code>. This makes installations reproducible and version-controlled. If you reinstall your operating system or set up a new machine, the exact same tools will appear automatically. And because software installation is tied to your configuration (not to manual actions), System Manager prevents drift--no forgotten tools, no mismatched versions across machines, and no surprises when you rollback or update.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To install software, you add attributes to the <code>config.environment.systemPackages</code> attribute set.</p>
</div>
<h2 id="example-installing-a-couple-apps">Example: Installing a couple apps<a class="headerlink" href="#example-installing-a-couple-apps" title="Permanent link">&para;</a></h2>
<p>Starting with a flake such as this:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-13-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-13-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-13-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-13-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-13-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-13-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-13-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-13-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-13-10">10</a></span>
<span class="normal"><a href="#__codelineno-13-11">11</a></span>
<span class="normal"><a href="#__codelineno-13-12">12</a></span>
<span class="normal"><a href="#__codelineno-13-13">13</a></span>
<span class="normal"><a href="#__codelineno-13-14">14</a></span>
<span class="normal"><a href="#__codelineno-13-15">15</a></span>
<span class="normal"><a href="#__codelineno-13-16">16</a></span>
<span class="normal"><a href="#__codelineno-13-17">17</a></span>
<span class="normal"><a href="#__codelineno-13-18">18</a></span>
<span class="normal"><a href="#__codelineno-13-19">19</a></span>
<span class="normal"><a href="#__codelineno-13-20">20</a></span>
<span class="normal"><a href="#__codelineno-13-21">21</a></span>
<span class="normal"><a href="#__codelineno-13-22">22</a></span>
<span class="normal"><a href="#__codelineno-13-23">23</a></span>
<span class="normal"><a href="#__codelineno-13-24">24</a></span>
<span class="normal"><a href="#__codelineno-13-25">25</a></span>
<span class="normal"><a href="#__codelineno-13-26">26</a></span>
<span class="normal"><a href="#__codelineno-13-27">27</a></span>
<span class="normal"><a href="#__codelineno-13-28">28</a></span>
<span class="normal"><a href="#__codelineno-13-29">29</a></span>
<span class="normal"><a href="#__codelineno-13-30">30</a></span>
<span class="normal"><a href="#__codelineno-13-31">31</a></span>
<span class="normal"><a href="#__codelineno-13-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="p">{</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a>  <span class="ss">description</span> <span class="o">=</span> <span class="s2">&quot;Standalone System Manager configuration&quot;</span><span class="p">;</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a>  <span class="ss">inputs</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a>    <span class="c1"># Specify the source of System Manager and Nixpkgs.</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a>    nixpkgs<span class="o">.</span><span class="ss">url</span> <span class="o">=</span> <span class="s2">&quot;github:nixos/nixpkgs/nixos-unstable&quot;</span><span class="p">;</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a>    <span class="ss">system-manager</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a>      <span class="ss">url</span> <span class="o">=</span> <span class="s2">&quot;github:numtide/system-manager&quot;</span><span class="p">;</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a>      inputs<span class="o">.</span>nixpkgs<span class="o">.</span><span class="ss">follows</span> <span class="o">=</span> <span class="s2">&quot;nixpkgs&quot;</span><span class="p">;</span>
<a id="__codelineno-13-10" name="__codelineno-13-10"></a>    <span class="p">};</span>
<a id="__codelineno-13-11" name="__codelineno-13-11"></a>  <span class="p">};</span>
<a id="__codelineno-13-12" name="__codelineno-13-12"></a>
<a id="__codelineno-13-13" name="__codelineno-13-13"></a>  <span class="ss">outputs</span> <span class="o">=</span>
<a id="__codelineno-13-14" name="__codelineno-13-14"></a>    <span class="p">{</span>
<a id="__codelineno-13-15" name="__codelineno-13-15"></a>      self<span class="p">,</span>
<a id="__codelineno-13-16" name="__codelineno-13-16"></a>      nixpkgs<span class="p">,</span>
<a id="__codelineno-13-17" name="__codelineno-13-17"></a>      system-manager<span class="p">,</span>
<a id="__codelineno-13-18" name="__codelineno-13-18"></a>      <span class="o">...</span>
<a id="__codelineno-13-19" name="__codelineno-13-19"></a>    <span class="p">}:</span>
<a id="__codelineno-13-20" name="__codelineno-13-20"></a>    <span class="k">let</span>
<a id="__codelineno-13-21" name="__codelineno-13-21"></a>      <span class="ss">system</span> <span class="o">=</span> <span class="s2">&quot;x86_64-linux&quot;</span><span class="p">;</span>
<a id="__codelineno-13-22" name="__codelineno-13-22"></a>    <span class="k">in</span>
<a id="__codelineno-13-23" name="__codelineno-13-23"></a>    <span class="p">{</span>
<a id="__codelineno-13-24" name="__codelineno-13-24"></a>      systemConfigs<span class="o">.</span><span class="ss">default</span> <span class="o">=</span> system-manager<span class="o">.</span>lib<span class="o">.</span>makeSystemConfig <span class="p">{</span>
<a id="__codelineno-13-25" name="__codelineno-13-25"></a>        <span class="c1"># Specify your system configuration modules here, for example,</span>
<a id="__codelineno-13-26" name="__codelineno-13-26"></a>        <span class="c1"># the path to your system.nix.</span>
<a id="__codelineno-13-27" name="__codelineno-13-27"></a>        <span class="ss">modules</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-13-28" name="__codelineno-13-28"></a>          <span class="l">./apps.nix</span>
<a id="__codelineno-13-29" name="__codelineno-13-29"></a>        <span class="p">];</span>
<a id="__codelineno-13-30" name="__codelineno-13-30"></a>      <span class="p">};</span>
<a id="__codelineno-13-31" name="__codelineno-13-31"></a>    <span class="p">};</span>
<a id="__codelineno-13-32" name="__codelineno-13-32"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Notice this flake references a file called <code>apps.nix</code>. In that file we'll add to the <code>systemPackages</code> attribute. Here's the <code>apps.nix</code> file:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span>
<span class="normal"><a href="#__codelineno-14-11">11</a></span>
<span class="normal"><a href="#__codelineno-14-12">12</a></span>
<span class="normal"><a href="#__codelineno-14-13">13</a></span>
<span class="normal"><a href="#__codelineno-14-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="p">{</span> lib<span class="p">,</span> pkgs<span class="p">,</span> <span class="o">...</span> <span class="p">}:</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="p">{</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a>  <span class="ss">config</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a>    nixpkgs<span class="o">.</span><span class="ss">hostPlatform</span> <span class="o">=</span> <span class="s2">&quot;x86_64-linux&quot;</span><span class="p">;</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a>    <span class="ss">environment</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a>      <span class="c1"># Packages that should be installed on a system</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a>      <span class="ss">systemPackages</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a>        pkgs<span class="o">.</span>hello
<a id="__codelineno-14-10" name="__codelineno-14-10"></a>        pkgs<span class="o">.</span>bat
<a id="__codelineno-14-11" name="__codelineno-14-11"></a>      <span class="p">];</span>
<a id="__codelineno-14-12" name="__codelineno-14-12"></a>    <span class="p">};</span>
<a id="__codelineno-14-13" name="__codelineno-14-13"></a>  <span class="p">};</span>
<a id="__codelineno-14-14" name="__codelineno-14-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>When you run System Manager, you should have the packages <code>hello</code> and <code>bat</code> available.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span>
<span class="normal"><a href="#__codelineno-15-2">2</a></span>
<span class="normal"><a href="#__codelineno-15-3">3</a></span>
<span class="normal"><a href="#__codelineno-15-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="gp">$ </span>which<span class="w"> </span>hello
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="go">/run/system-manager/sw/bin//hello</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="gp">$ </span>which<span class="w"> </span>bat
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="go">/run/system-manager/sw/bin//bat</span>
</code></pre></div></td></tr></table></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The first time you install an app through System Manager, System Manager will add a file inside <code>/etc/profile.d/</code>. This file adds <code>/run/system-manager/sw/bin/</code> to a user's path when they log in. If this is the first time you've installed an app on this system with System Manager, you'll need to either source that file, or simply log out and log back in.</p>
</div>
<p>If you prefer, you can combine the above two <code>.nix</code> files into a single flake:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-16-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-16-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-16-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-16-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-16-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-16-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-16-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-16-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-16-10">10</a></span>
<span class="normal"><a href="#__codelineno-16-11">11</a></span>
<span class="normal"><a href="#__codelineno-16-12">12</a></span>
<span class="normal"><a href="#__codelineno-16-13">13</a></span>
<span class="normal"><a href="#__codelineno-16-14">14</a></span>
<span class="normal"><a href="#__codelineno-16-15">15</a></span>
<span class="normal"><a href="#__codelineno-16-16">16</a></span>
<span class="normal"><a href="#__codelineno-16-17">17</a></span>
<span class="normal"><a href="#__codelineno-16-18">18</a></span>
<span class="normal"><a href="#__codelineno-16-19">19</a></span>
<span class="normal"><a href="#__codelineno-16-20">20</a></span>
<span class="normal"><a href="#__codelineno-16-21">21</a></span>
<span class="normal"><a href="#__codelineno-16-22">22</a></span>
<span class="normal"><a href="#__codelineno-16-23">23</a></span>
<span class="normal"><a href="#__codelineno-16-24">24</a></span>
<span class="normal"><a href="#__codelineno-16-25">25</a></span>
<span class="normal"><a href="#__codelineno-16-26">26</a></span>
<span class="normal"><a href="#__codelineno-16-27">27</a></span>
<span class="normal"><a href="#__codelineno-16-28">28</a></span>
<span class="normal"><a href="#__codelineno-16-29">29</a></span>
<span class="normal"><a href="#__codelineno-16-30">30</a></span>
<span class="normal"><a href="#__codelineno-16-31">31</a></span>
<span class="normal"><a href="#__codelineno-16-32">32</a></span>
<span class="normal"><a href="#__codelineno-16-33">33</a></span>
<span class="normal"><a href="#__codelineno-16-34">34</a></span>
<span class="normal"><a href="#__codelineno-16-35">35</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="p">{</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a>  <span class="ss">description</span> <span class="o">=</span> <span class="s2">&quot;Standalone System Manager configuration&quot;</span><span class="p">;</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a>  <span class="ss">inputs</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a>    nixpkgs<span class="o">.</span><span class="ss">url</span> <span class="o">=</span> <span class="s2">&quot;github:nixos/nixpkgs/nixos-unstable&quot;</span><span class="p">;</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a>    <span class="ss">system-manager</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a>      <span class="ss">url</span> <span class="o">=</span> <span class="s2">&quot;github:numtide/system-manager&quot;</span><span class="p">;</span>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a>      inputs<span class="o">.</span>nixpkgs<span class="o">.</span><span class="ss">follows</span> <span class="o">=</span> <span class="s2">&quot;nixpkgs&quot;</span><span class="p">;</span>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a>    <span class="p">};</span>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a>  <span class="p">};</span>
<a id="__codelineno-16-10" name="__codelineno-16-10"></a>  <span class="ss">outputs</span> <span class="o">=</span>
<a id="__codelineno-16-11" name="__codelineno-16-11"></a>    <span class="p">{</span>
<a id="__codelineno-16-12" name="__codelineno-16-12"></a>      self<span class="p">,</span>
<a id="__codelineno-16-13" name="__codelineno-16-13"></a>      nixpkgs<span class="p">,</span>
<a id="__codelineno-16-14" name="__codelineno-16-14"></a>      system-manager<span class="p">,</span>
<a id="__codelineno-16-15" name="__codelineno-16-15"></a>      <span class="o">...</span>
<a id="__codelineno-16-16" name="__codelineno-16-16"></a>    <span class="p">}:</span>
<a id="__codelineno-16-17" name="__codelineno-16-17"></a>    <span class="k">let</span>
<a id="__codelineno-16-18" name="__codelineno-16-18"></a>      <span class="ss">system</span> <span class="o">=</span> <span class="s2">&quot;x86_64-linux&quot;</span><span class="p">;</span>
<a id="__codelineno-16-19" name="__codelineno-16-19"></a>    <span class="k">in</span>
<a id="__codelineno-16-20" name="__codelineno-16-20"></a>    <span class="p">{</span>
<a id="__codelineno-16-21" name="__codelineno-16-21"></a>      systemConfigs<span class="o">.</span><span class="ss">default</span> <span class="o">=</span> system-manager<span class="o">.</span>lib<span class="o">.</span>makeSystemConfig <span class="p">{</span>
<a id="__codelineno-16-22" name="__codelineno-16-22"></a>        <span class="ss">modules</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-16-23" name="__codelineno-16-23"></a>          <span class="p">({</span> lib<span class="p">,</span> pkgs<span class="p">,</span> <span class="o">...</span> <span class="p">}:</span> <span class="p">{</span>
<a id="__codelineno-16-24" name="__codelineno-16-24"></a>            <span class="ss">config</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-16-25" name="__codelineno-16-25"></a>              nixpkgs<span class="o">.</span><span class="ss">hostPlatform</span> <span class="o">=</span> <span class="s2">&quot;x86_64-linux&quot;</span><span class="p">;</span>
<a id="__codelineno-16-26" name="__codelineno-16-26"></a>              environment<span class="o">.</span><span class="ss">systemPackages</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-16-27" name="__codelineno-16-27"></a>                pkgs<span class="o">.</span>hello
<a id="__codelineno-16-28" name="__codelineno-16-28"></a>                pkgs<span class="o">.</span>bat
<a id="__codelineno-16-29" name="__codelineno-16-29"></a>              <span class="p">];</span>
<a id="__codelineno-16-30" name="__codelineno-16-30"></a>            <span class="p">};</span>
<a id="__codelineno-16-31" name="__codelineno-16-31"></a>          <span class="p">})</span>
<a id="__codelineno-16-32" name="__codelineno-16-32"></a>        <span class="p">];</span>
<a id="__codelineno-16-33" name="__codelineno-16-33"></a>      <span class="p">};</span>
<a id="__codelineno-16-34" name="__codelineno-16-34"></a>    <span class="p">};</span>
<a id="__codelineno-16-35" name="__codelineno-16-35"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h1 id="working-with-etc-files-declaratively">Working With <code>/etc</code> Files Declaratively<a class="headerlink" href="#working-with-etc-files-declaratively" title="Permanent link">&para;</a></h1>
<p>Many applications and services rely on configuration files stored under <code>/etc</code>, and System Manager lets you manage those files declaratively as well. Instead of manually editing files like <code>/etc/some_config</code>, you define them in your Nix configuration and let System Manager write them during a switch. This ensures that your system state is always consistent with your configuration and avoids accidental edits or configuration drift. If you ever rebuild your machine, those files are recreated exactly as before, including permissions, contents, and paths. And because System Manager keeps previous generations, you can safely roll back to earlier versions of <code>/etc</code> files if needed. Declarative <code>/etc</code> management is especially powerful in shared or multi-machine environments, where consistency and repeatability matter most.</p>
<p>Oftentimes, when you're creating a system service, you need to create a configuration file in the <code>/etc</code> directory that accompanies the service. System Manager allows you to do that as well.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To install software, you add attributes to the <code>config.environment.etc</code> attribute set.</p>
</div>
<h2 id="example-creating-a-file-in-etc">Example: Creating a file in <code>/etc</code><a class="headerlink" href="#example-creating-a-file-in-etc" title="Permanent link">&para;</a></h2>
<p>Starting with a flake such as this:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-17-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-17-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-17-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-17-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-17-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-17-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-17-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-17-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-17-10">10</a></span>
<span class="normal"><a href="#__codelineno-17-11">11</a></span>
<span class="normal"><a href="#__codelineno-17-12">12</a></span>
<span class="normal"><a href="#__codelineno-17-13">13</a></span>
<span class="normal"><a href="#__codelineno-17-14">14</a></span>
<span class="normal"><a href="#__codelineno-17-15">15</a></span>
<span class="normal"><a href="#__codelineno-17-16">16</a></span>
<span class="normal"><a href="#__codelineno-17-17">17</a></span>
<span class="normal"><a href="#__codelineno-17-18">18</a></span>
<span class="normal"><a href="#__codelineno-17-19">19</a></span>
<span class="normal"><a href="#__codelineno-17-20">20</a></span>
<span class="normal"><a href="#__codelineno-17-21">21</a></span>
<span class="normal"><a href="#__codelineno-17-22">22</a></span>
<span class="normal"><a href="#__codelineno-17-23">23</a></span>
<span class="normal"><a href="#__codelineno-17-24">24</a></span>
<span class="normal"><a href="#__codelineno-17-25">25</a></span>
<span class="normal"><a href="#__codelineno-17-26">26</a></span>
<span class="normal"><a href="#__codelineno-17-27">27</a></span>
<span class="normal"><a href="#__codelineno-17-28">28</a></span>
<span class="normal"><a href="#__codelineno-17-29">29</a></span>
<span class="normal"><a href="#__codelineno-17-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="p">{</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a>  <span class="ss">description</span> <span class="o">=</span> <span class="s2">&quot;Standalone System Manager configuration&quot;</span><span class="p">;</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a>  <span class="ss">inputs</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a>    <span class="c1"># Specify the source of System Manager and Nixpkgs.</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a>    nixpkgs<span class="o">.</span><span class="ss">url</span> <span class="o">=</span> <span class="s2">&quot;github:nixos/nixpkgs/nixos-unstable&quot;</span><span class="p">;</span>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a>    <span class="ss">system-manager</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a>      <span class="ss">url</span> <span class="o">=</span> <span class="s2">&quot;github:numtide/system-manager&quot;</span><span class="p">;</span>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a>      inputs<span class="o">.</span>nixpkgs<span class="o">.</span><span class="ss">follows</span> <span class="o">=</span> <span class="s2">&quot;nixpkgs&quot;</span><span class="p">;</span>
<a id="__codelineno-17-10" name="__codelineno-17-10"></a>    <span class="p">};</span>
<a id="__codelineno-17-11" name="__codelineno-17-11"></a>  <span class="p">};</span>
<a id="__codelineno-17-12" name="__codelineno-17-12"></a>
<a id="__codelineno-17-13" name="__codelineno-17-13"></a>  <span class="ss">outputs</span> <span class="o">=</span>
<a id="__codelineno-17-14" name="__codelineno-17-14"></a>    <span class="p">{</span>
<a id="__codelineno-17-15" name="__codelineno-17-15"></a>      self<span class="p">,</span>
<a id="__codelineno-17-16" name="__codelineno-17-16"></a>      nixpkgs<span class="p">,</span>
<a id="__codelineno-17-17" name="__codelineno-17-17"></a>      system-manager<span class="p">,</span>
<a id="__codelineno-17-18" name="__codelineno-17-18"></a>      <span class="o">...</span>
<a id="__codelineno-17-19" name="__codelineno-17-19"></a>    <span class="p">}:</span>
<a id="__codelineno-17-20" name="__codelineno-17-20"></a>    <span class="k">let</span>
<a id="__codelineno-17-21" name="__codelineno-17-21"></a>      <span class="ss">system</span> <span class="o">=</span> <span class="s2">&quot;x86_64-linux&quot;</span><span class="p">;</span>
<a id="__codelineno-17-22" name="__codelineno-17-22"></a>    <span class="k">in</span>
<a id="__codelineno-17-23" name="__codelineno-17-23"></a>    <span class="p">{</span>
<a id="__codelineno-17-24" name="__codelineno-17-24"></a>      systemConfigs<span class="o">.</span><span class="ss">default</span> <span class="o">=</span> system-manager<span class="o">.</span>lib<span class="o">.</span>makeSystemConfig <span class="p">{</span>
<a id="__codelineno-17-25" name="__codelineno-17-25"></a>        <span class="ss">modules</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-17-26" name="__codelineno-17-26"></a>          <span class="l">./files1.nix</span>
<a id="__codelineno-17-27" name="__codelineno-17-27"></a>        <span class="p">];</span>
<a id="__codelineno-17-28" name="__codelineno-17-28"></a>      <span class="p">};</span>
<a id="__codelineno-17-29" name="__codelineno-17-29"></a>    <span class="p">};</span>
<a id="__codelineno-17-30" name="__codelineno-17-30"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Notice this references a file called <code>files1.nix</code>. To create files, you add attributes to the <code>config.environment.etc</code> attribute set as follows:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span>
<span class="normal"><a href="#__codelineno-18-11">11</a></span>
<span class="normal"><a href="#__codelineno-18-12">12</a></span>
<span class="normal"><a href="#__codelineno-18-13">13</a></span>
<span class="normal"><a href="#__codelineno-18-14">14</a></span>
<span class="normal"><a href="#__codelineno-18-15">15</a></span>
<span class="normal"><a href="#__codelineno-18-16">16</a></span>
<span class="normal"><a href="#__codelineno-18-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="p">{</span> lib<span class="p">,</span> pkgs<span class="p">,</span> <span class="o">...</span> <span class="p">}:</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="p">{</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a>  <span class="ss">config</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a>    <span class="ss">environment</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a>      <span class="ss">etc</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a>        <span class="s2">&quot;test/test2/something.txt&quot;</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a>          <span class="ss">text</span> <span class="o">=</span> <span class="s s-Multiline">&#39;&#39;</span>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="s s-Multiline">            This is just a test!!</span>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="s s-Multiline">          &#39;&#39;</span><span class="p">;</span>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a>          <span class="ss">mode</span> <span class="o">=</span> <span class="s2">&quot;0755&quot;</span><span class="p">;</span>
<a id="__codelineno-18-11" name="__codelineno-18-11"></a>          <span class="ss">user</span> <span class="o">=</span> <span class="s2">&quot;ubuntu&quot;</span><span class="p">;</span>
<a id="__codelineno-18-12" name="__codelineno-18-12"></a>          <span class="ss">group</span> <span class="o">=</span> <span class="s2">&quot;ubuntu&quot;</span><span class="p">;</span>
<a id="__codelineno-18-13" name="__codelineno-18-13"></a>        <span class="p">};</span>
<a id="__codelineno-18-14" name="__codelineno-18-14"></a>      <span class="p">};</span>
<a id="__codelineno-18-15" name="__codelineno-18-15"></a>    <span class="p">};</span>
<a id="__codelineno-18-16" name="__codelineno-18-16"></a>  <span class="p">};</span>
<a id="__codelineno-18-17" name="__codelineno-18-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>This creates a single file inside the folder <code>/etc/test/test2/</code> called <code>something.txt</code>.</p>
<p>After running the above with System Manager, you can verify the file exists:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">1</a></span>
<span class="normal"><a href="#__codelineno-19-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="gp">$ </span>cat<span class="w"> </span>/etc/test/test2/something.txt
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="go">This is just a test!!</span>
</code></pre></div></td></tr></table></div>
<p>Note that if you prefer, you can combine the above flake and separate <code>.nix</code> file into a single flake like so:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span>
<span class="normal"><a href="#__codelineno-20-11">11</a></span>
<span class="normal"><a href="#__codelineno-20-12">12</a></span>
<span class="normal"><a href="#__codelineno-20-13">13</a></span>
<span class="normal"><a href="#__codelineno-20-14">14</a></span>
<span class="normal"><a href="#__codelineno-20-15">15</a></span>
<span class="normal"><a href="#__codelineno-20-16">16</a></span>
<span class="normal"><a href="#__codelineno-20-17">17</a></span>
<span class="normal"><a href="#__codelineno-20-18">18</a></span>
<span class="normal"><a href="#__codelineno-20-19">19</a></span>
<span class="normal"><a href="#__codelineno-20-20">20</a></span>
<span class="normal"><a href="#__codelineno-20-21">21</a></span>
<span class="normal"><a href="#__codelineno-20-22">22</a></span>
<span class="normal"><a href="#__codelineno-20-23">23</a></span>
<span class="normal"><a href="#__codelineno-20-24">24</a></span>
<span class="normal"><a href="#__codelineno-20-25">25</a></span>
<span class="normal"><a href="#__codelineno-20-26">26</a></span>
<span class="normal"><a href="#__codelineno-20-27">27</a></span>
<span class="normal"><a href="#__codelineno-20-28">28</a></span>
<span class="normal"><a href="#__codelineno-20-29">29</a></span>
<span class="normal"><a href="#__codelineno-20-30">30</a></span>
<span class="normal"><a href="#__codelineno-20-31">31</a></span>
<span class="normal"><a href="#__codelineno-20-32">32</a></span>
<span class="normal"><a href="#__codelineno-20-33">33</a></span>
<span class="normal"><a href="#__codelineno-20-34">34</a></span>
<span class="normal"><a href="#__codelineno-20-35">35</a></span>
<span class="normal"><a href="#__codelineno-20-36">36</a></span>
<span class="normal"><a href="#__codelineno-20-37">37</a></span>
<span class="normal"><a href="#__codelineno-20-38">38</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="p">{</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a>  <span class="ss">description</span> <span class="o">=</span> <span class="s2">&quot;Standalone System Manager configuration&quot;</span><span class="p">;</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a>  <span class="ss">inputs</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a>    <span class="c1"># Specify the source of System Manager and Nixpkgs.</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a>    nixpkgs<span class="o">.</span><span class="ss">url</span> <span class="o">=</span> <span class="s2">&quot;github:nixos/nixpkgs/nixos-unstable&quot;</span><span class="p">;</span>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a>    <span class="ss">system-manager</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a>      <span class="ss">url</span> <span class="o">=</span> <span class="s2">&quot;github:numtide/system-manager&quot;</span><span class="p">;</span>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a>      inputs<span class="o">.</span>nixpkgs<span class="o">.</span><span class="ss">follows</span> <span class="o">=</span> <span class="s2">&quot;nixpkgs&quot;</span><span class="p">;</span>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a>    <span class="p">};</span>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a>  <span class="p">};</span>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a>  <span class="ss">outputs</span> <span class="o">=</span>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a>    <span class="p">{</span>
<a id="__codelineno-20-13" name="__codelineno-20-13"></a>      self<span class="p">,</span>
<a id="__codelineno-20-14" name="__codelineno-20-14"></a>      nixpkgs<span class="p">,</span>
<a id="__codelineno-20-15" name="__codelineno-20-15"></a>      system-manager<span class="p">,</span>
<a id="__codelineno-20-16" name="__codelineno-20-16"></a>      <span class="o">...</span>
<a id="__codelineno-20-17" name="__codelineno-20-17"></a>    <span class="p">}:</span>
<a id="__codelineno-20-18" name="__codelineno-20-18"></a>    <span class="k">let</span>
<a id="__codelineno-20-19" name="__codelineno-20-19"></a>      <span class="ss">system</span> <span class="o">=</span> <span class="s2">&quot;x86_64-linux&quot;</span><span class="p">;</span>
<a id="__codelineno-20-20" name="__codelineno-20-20"></a>    <span class="k">in</span>
<a id="__codelineno-20-21" name="__codelineno-20-21"></a>    <span class="p">{</span>
<a id="__codelineno-20-22" name="__codelineno-20-22"></a>      systemConfigs<span class="o">.</span><span class="ss">default</span> <span class="o">=</span> system-manager<span class="o">.</span>lib<span class="o">.</span>makeSystemConfig <span class="p">{</span>
<a id="__codelineno-20-23" name="__codelineno-20-23"></a>        <span class="ss">modules</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-20-24" name="__codelineno-20-24"></a>          <span class="p">{</span>
<a id="__codelineno-20-25" name="__codelineno-20-25"></a>            config<span class="o">.</span>nixpkgs<span class="o">.</span><span class="ss">hostPlatform</span> <span class="o">=</span> <span class="s2">&quot;x86_64-linux&quot;</span><span class="p">;</span>
<a id="__codelineno-20-26" name="__codelineno-20-26"></a>            config<span class="o">.</span>environment<span class="o">.</span>etc<span class="o">.</span><span class="s2">&quot;test/test2/something.txt&quot;</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-20-27" name="__codelineno-20-27"></a>                <span class="ss">text</span> <span class="o">=</span> <span class="s s-Multiline">&#39;&#39;</span>
<a id="__codelineno-20-28" name="__codelineno-20-28"></a><span class="s s-Multiline">                  This is just a test!!!</span>
<a id="__codelineno-20-29" name="__codelineno-20-29"></a><span class="s s-Multiline">                &#39;&#39;</span><span class="p">;</span>
<a id="__codelineno-20-30" name="__codelineno-20-30"></a>                <span class="ss">mode</span> <span class="o">=</span> <span class="s2">&quot;0755&quot;</span><span class="p">;</span>
<a id="__codelineno-20-31" name="__codelineno-20-31"></a>                <span class="ss">user</span> <span class="o">=</span> <span class="s2">&quot;ubuntu&quot;</span><span class="p">;</span>
<a id="__codelineno-20-32" name="__codelineno-20-32"></a>                <span class="ss">group</span> <span class="o">=</span> <span class="s2">&quot;ubuntu&quot;</span><span class="p">;</span>
<a id="__codelineno-20-33" name="__codelineno-20-33"></a>            <span class="p">};</span>
<a id="__codelineno-20-34" name="__codelineno-20-34"></a>          <span class="p">}</span>
<a id="__codelineno-20-35" name="__codelineno-20-35"></a>        <span class="p">];</span>
<a id="__codelineno-20-36" name="__codelineno-20-36"></a>      <span class="p">};</span>
<a id="__codelineno-20-37" name="__codelineno-20-37"></a>    <span class="p">};</span>
<a id="__codelineno-20-38" name="__codelineno-20-38"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="permissions">Permissions<a class="headerlink" href="#permissions" title="Permanent link">&para;</a></h2>
<p>NixOS uses the standard modes of file permissions, consisting of three octal digits; the first represents the user; the second represents the group; the third represents all other users (sometimes called "world" or "others").</p>
<p>Each digit is the sum of the permissions it grants:</p>
<ul>
<li>4 = read (r)</li>
<li>2 = write (w)</li>
<li>1 = execute (x)</li>
</ul>
<p>So "0755" means:</p>
<ul>
<li>7 (4+2+1) = owner can read, write, and execute</li>
<li>5 (4+1) = group can read and execute</li>
<li>5 (4+1) = others can read and execute</li>
</ul>
<p>Common examples:</p>
<p><strong>"0644"</strong> = owner can read/write, everyone else can only read</p>
<p><strong>"0755"</strong> = owner can do everything, everyone else can read and execute</p>
<p><strong>"0400"</strong> = owner can only read, nobody else can do anything</p>
<p><strong>"0600"</strong> = owner can read/write, nobody else can touch it</p>
<h2 id="users-and-groups">Users and Groups<a class="headerlink" href="#users-and-groups" title="Permanent link">&para;</a></h2>
<p>To specify a user and group as owners for a file, you can either use the user ID and group ID, or the user name and group name. Here's an example that uses user ID and group ID (notice we set <code>uid</code> and <code>gid</code>):</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">1</a></span>
<span class="normal"><a href="#__codelineno-21-2">2</a></span>
<span class="normal"><a href="#__codelineno-21-3">3</a></span>
<span class="normal"><a href="#__codelineno-21-4">4</a></span>
<span class="normal"><a href="#__codelineno-21-5">5</a></span>
<span class="normal"><a href="#__codelineno-21-6">6</a></span>
<span class="normal"><a href="#__codelineno-21-7">7</a></span>
<span class="normal"><a href="#__codelineno-21-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="ss">with_ownership</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a>  <span class="ss">text</span> <span class="o">=</span> <span class="s s-Multiline">&#39;&#39;</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="s s-Multiline">    This is just a test!</span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="s s-Multiline">  &#39;&#39;</span><span class="p">;</span>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a>  <span class="ss">mode</span> <span class="o">=</span> <span class="s2">&quot;0755&quot;</span><span class="p">;</span>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a>  <span class="ss">uid</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<a id="__codelineno-21-7" name="__codelineno-21-7"></a>  <span class="ss">gid</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
<a id="__codelineno-21-8" name="__codelineno-21-8"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>And here's an example that uses named user and group (notice we set <code>user</code> and <code>group</code>):</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1">1</a></span>
<span class="normal"><a href="#__codelineno-22-2">2</a></span>
<span class="normal"><a href="#__codelineno-22-3">3</a></span>
<span class="normal"><a href="#__codelineno-22-4">4</a></span>
<span class="normal"><a href="#__codelineno-22-5">5</a></span>
<span class="normal"><a href="#__codelineno-22-6">6</a></span>
<span class="normal"><a href="#__codelineno-22-7">7</a></span>
<span class="normal"><a href="#__codelineno-22-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="ss">with_ownership2</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a>  <span class="ss">text</span> <span class="o">=</span> <span class="s s-Multiline">&#39;&#39;</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="s s-Multiline">    This is just a test!</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="s s-Multiline">  &#39;&#39;</span><span class="p">;</span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a>  <span class="ss">mode</span> <span class="o">=</span> <span class="s2">&quot;0755&quot;</span><span class="p">;</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a>  <span class="ss">user</span> <span class="o">=</span> <span class="s2">&quot;nobody&quot;</span><span class="p">;</span>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a>  <span class="ss">group</span> <span class="o">=</span> <span class="s2">&quot;users&quot;</span><span class="p">;</span>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This use of <code>uid</code>/<code>gid</code> for numeric IDs and <code>user</code>/<code>group</code> for names aligns with NixOS standards.</p>
</div>
<h1 id="supporting-system-services-with-tmp-files-and-folders">Supporting System Services with tmp files and folders<a class="headerlink" href="#supporting-system-services-with-tmp-files-and-folders" title="Permanent link">&para;</a></h1>
<p>Some systemd services need runtime directories, temporary files, or specific filesystem structures to exist before they can start. The <code>systemd.tmpfiles</code> configuration provides a declarative way to create these files and directories, set their permissions and ownership, and manage cleanup policies. This is particularly useful for volatile directories like those under <code>/var/run/</code>, <code>/tmp/</code>, or custom application directories that need to be recreated on each boot with the correct permissions.</p>
<p>For example, if you're running a web application that stores temporary uploads in <code>/var/app/uploads/</code>, you can use tmpfiles to ensure this directory exists with the correct permissions when the system boots. Without tmpfiles, your service might fail to start because the directory doesn't exist yet, or it might have the wrong ownership and your application can't write to it.</p>
<p>For this we offer two distinct syntaxes you can use, depending on your needs, as shown in the following sample code:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span>
<span class="normal"><a href="#__codelineno-23-11">11</a></span>
<span class="normal"><a href="#__codelineno-23-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a>    <span class="c1"># Configure systemd tmpfile settings</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a>    systemd<span class="o">.</span><span class="ss">tmpfiles</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a>       <span class="ss">rules</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a>         <span class="s2">&quot;D /var/tmp/system-manager 0755 root root -&quot;</span>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a>       <span class="p">];</span>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a>       settings<span class="o">.</span><span class="ss">sample</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-23-8" name="__codelineno-23-8"></a>         <span class="s2">&quot;/var/tmp/sample&quot;</span><span class="o">.</span><span class="ss">d</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-23-9" name="__codelineno-23-9"></a>           <span class="ss">mode</span> <span class="o">=</span> <span class="s2">&quot;0755&quot;</span><span class="p">;</span>
<a id="__codelineno-23-10" name="__codelineno-23-10"></a>         <span class="p">};</span>
<a id="__codelineno-23-11" name="__codelineno-23-11"></a>       <span class="p">};</span>
<a id="__codelineno-23-12" name="__codelineno-23-12"></a>    <span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>The first example (<code>rules</code>), creates a directory called <code>/var/tmp/system-manager</code> with mode <code>0755</code>, owned by user root and group root. (The <code>-</code> means no age-based cleanup.)</p>
<p>The second example creates the same type of directory at <code>/var/tmp/sample</code> with mode <code>0755</code>, but uses the structured <code>settings</code> format. Since user and group aren't specified, they default to root. This Nix-friendly syntax is more readable and easier to maintain than raw <code>tmpfiles.d</code> strings.</p>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="January 6, 2026 13:05:24 UTC">January 6, 2026</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="January 6, 2026 13:05:24 UTC">January 6, 2026</span>
  </span>

    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../configuration/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Configuration">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Configuration
              </div>
            </div>
          </a>
        
        
          
          <a href="../remote-flakes/" class="md-footer__link md-footer__link--next" aria-label="Next: Remote Flakes">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Remote Flakes
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Content on this site is licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International license</a>.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/numtide" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://x.com/numtide" target="_blank" rel="noopener" title="x.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M357.2 48h70.6L273.6 224.2 455 464H313L201.7 318.6 74.5 464H3.8l164.9-188.5L-5.2 48h145.6l100.5 132.9zm-24.8 373.8h39.1L119.1 88h-42z"/></svg>
    </a>
  
    
    
      
    
    
    
      
      
    
    <a href="https://fosstodon.org/@numtide" target="_blank" rel="noopener me" title="fosstodon.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M433 179.1c0-97.2-63.7-125.7-63.7-125.7-62.5-28.7-228.6-28.4-290.5 0 0 0-63.7 28.5-63.7 125.7 0 115.7-6.6 259.4 105.6 289.1 40.5 10.7 75.3 13 103.3 11.4 50.8-2.8 79.3-18.1 79.3-18.1l-1.7-36.9s-36.3 11.4-77.1 10.1c-40.4-1.4-83-4.4-89.6-54-.6-4.6-.9-9.3-.9-13.9 85.6 20.9 158.7 9.1 178.7 6.7 56.1-6.7 105-41.3 111.2-72.9 9.8-49.8 9-121.5 9-121.5zm-75.1 125.2h-46.6V190.1c0-49.7-64-51.6-64 6.9v62.5H201V197c0-58.5-64-56.6-64-6.9v114.2H90.3c0-122.1-5.2-147.9 18.4-175 25.9-28.9 79.8-30.8 103.8 6.1l11.6 19.5 11.6-19.5c24.1-37.1 78.1-34.8 103.8-6.1 23.7 27.3 18.4 53 18.4 175"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["content.code.annotate", "content.code.copy", "navigation.footer", "navigation.indexes", "navigation.path", "navigation.sections", "navigation.tabs", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>